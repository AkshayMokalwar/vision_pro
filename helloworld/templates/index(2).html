<!DOCTYPE html>
{%load static%}
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- for design -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

  <title>Img_cap</title>

  <!-- just imported no use  -->
  <link rel="stylesheet" href="{%static '/css/main.css' %} ">
  <script src="{%static '/js/main.js' %} "></script>

</head>
<body>
  <!-- reference from the website  -->
  <a href="https://usefulangle.com/post/352/javascript-capture-image-from-camera">reference</a>

  <!-- if image not proper   -->
 


  <div class="container p-5" align="center">
    <!-- to activate the camera  -->
    {%if m%}
    <p style="color:brown;">{{m}}</p>
{%endif%}
    <button id="start-camera" class="btn btn-sm btn-warning">Start Camera</button><br>
    <div class="">
      <b>Your Cam:</b><br>
      <!-- camera live feed -->
      <video id="video" width="1280" height="720" autoplay  class="border border-5 border-danger"></video>
      
    </div>
    <div class="">
      <!-- to click & downloa the image -->
      <button id="click-photo" class="btn btn-sm btn-primary" >Click Photo</button><br>
      
    </div>
    <div class="mt-3" >

      <!-- displaying click image -->
      <b>Image clicked:</b>
      <br>
      <canvas id="canvas" width="1280" height="720" class="bg-light shadow border border-5 border-success"></canvas>
    </div>


    <!-- for post method not in use now  ignore-->

      
      {% if im_name %}
        
      
      {{im_name}}
      <hr>

    <h1>Image uploaded uploaded</h1>
      <br>
      <img src='/media/Output/{{im_name}}'  alt="{{im_name}}">
      <script>
        
      </script>
      
      {%endif%}

      <!-- end post -->


      <!--  -->
      <!-- Imp form div to get the image from client  -->
      <div id="fom" >
      <form method="post" enctype="multipart/form-data"  class="">
        <!-- csfr tocken for djangos -->
        {% csrf_token %}
       
      <!-- file input -->

      <input class="form-control" type="file" style="width:20%;display: inline-block;margin-right: 10%;" id="f" onchange="updateFilename(this.value)" name="up_img"  >

      <label for="cars">Choose a car:</label>

        <!-- drop down -->
      <select class="form-control" style="width:10%;display: inline-block;margin-right: 10%;" name="features" id="features_id">
        <option value="text">Text recognition</option>
        <option value="Search">Search Image</option>
        <option value="barcode">Barcode Scan</option>
        <option value="cartoonify">cartoonify Image</option>
      </select>
      <!-- submit button hit the server and send the image to server using post method -->
      <input class=" btn btn-success" type="submit" id="submit" value="final submit "style="width:10%;">	
      
      
      </form>
    </div>
    <!-- end of form div -->

  </div>
      <!-- Javascript for camera image -->
      <script>
        function updateFilename(path) {
   alert(path);
 }
        let camera_button = document.querySelector("#start-camera");
    let video = document.querySelector("#video");
    let click_button = document.querySelector("#click-photo");
    let canvas = document.querySelector("#canvas");
    
    camera_button.addEventListener('click', async function() {
         let stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
      video.srcObject = stream;
    });
    var n=0;
    click_button.addEventListener('click', function() {
        canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
        // converting js canvas to image
        let image_data_url = canvas.toDataURL('image/jpeg');
        
        let anchor = document.createElement("a");
        anchor.download = "download"+parseInt(n)+".jpg";
        n++;
        anchor.href = image_data_url;
        // alert(anchor.href);

        // to download clicked image
        anchor.click();

        //
        document.getElementById("fom").style.display="block";
         // data url of the image
        //  console.log(image_data_url);
    });
    </script>
 
</body>
</html>